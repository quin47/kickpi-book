# 23-多屏异显双触摸方案





## 显示接口资源介绍

RK3568 有三个VP节点，每个VP节点可挂接一个显示屏，对应关系如下表格示

| VP编号 | 支持显示屏                        | 最大分辨率     |
| ------ | --------------------------------- | -------------- |
| VP0    | MIPI0 / MIPI1 / HDMI / EDP        | 4096x2304@60Hz |
| VP1    | MIPI0 / MIPI1 / LVDS / HDMI / EDP | 2048x1536@60Hz |
| VP2    | LVDS / RGB                        | 1920x1080@60Hz |

> MIPI0与LVDS接口引脚冲突，只能二选一
>
> VP2节点仅支持LVDS/RGB，所以三屏显示其中一路必须是LVDS（RGB接口未引出）



## 多屏显示配置

多屏显示方案中，推荐选择分辨率比例一致的显示屏，否则会出现画面拉伸或者画面黑边



### 内核设备树配置

```
$ vim kernel-5.10/arch/arm64/boot/dts/rockchip/rk3568-kickpi-k1a.dtsi

//#include "rk3568-kickpi-lcd-edp.dtsi"
//#include "rk3568-kickpi-lcd-mipi0.dtsi"
#include "rk3568-kickpi-lcd-mipi1.dtsi"
#include "rk3568-kickpi-lcd-lvds.dtsi"
#include "rk3568-kickpi-lcd-hdmi.dtsi"
```



### Android多屏显示应用程序开发

* DSI作为主屏，HDMI-A作为副屏

```
PRODUCT_PROPERTY_OVERRIDES += vendor.hwc.device.primary=DSI
PRODUCT_PROPERTY_OVERRIDES += vendor.hwc.device.extend=HDMI-A
```

* DSI\eDP作为主屏，LVDS\HDMI-A作为副屏

```
PRODUCT_PROPERTY_OVERRIDES += vendor.hwc.device.primary=DSI,eDP
PRODUCT_PROPERTY_OVERRIDES += vendor.hwc.device.extend=LVDS,HDMI-A
```



### UBUNTU/DEBIAN多屏显示配置

示例方案：HDMI + MIPI1 + LVDS





## 多屏触摸配置

### 内核设备树配置

I2C + I2C





### Android单屏触摸配置

* Android11.0 仅主屏触摸，禁止副屏触摸

```
$ vim frameworks/native/services/inputflinger/reader/EventHub.cpp

    // Determine whether the device is external or internal.
    if (isExternalDeviceLocked(device)) {
-        device->classes |= INPUT_DEVICE_CLASS_EXTERNAL;
+        //device->classes |= INPUT_DEVICE_CLASS_EXTERNAL;
    }
```

* Android13.0 仅主屏触摸，禁止副屏触摸

```
$ vim frameworks/native/services/inputflinger/reader/EventHub.cpp

	// Determine whether the device is external or internal.
    if (device->isExternalDeviceLocked()) {
-        device->classes |= InputDeviceClass::EXTERNAL;
+        //device->classes |= InputDeviceClass::EXTERNAL;
    }
```



### Android多屏触摸配置

```
frameworks/native/services/inputflinger/reader/EventHub.cpp

bool EventHub::isExternalDeviceLocked(Device* device) {
	const char *I2C_DEVICE_NAME = "generic ft5x06 (79)";
	ALOGE("input deviceis '%s' ",device->identifier.name.c_str());
	if (strcmp(device->identifier.name.c_str(), I2C_DEVICE_NAME) == 0) {
		return true;
	}
}
```



* 添加IDC配置文件



### Ubuntu/Debian多屏触摸配置











