# 04-拓展引脚

## 扩展引脚<a id="ExpansionPin"> </a>

### K1引脚列表

![image-20240420181207097](http://tanzhtanzh.oss-cn-shenzhen.aliyuncs.com/img/image-20240420181207097.png)



### K1B引脚列表

![image-20240914152349051](http://tanzhtanzh.oss-cn-shenzhen.aliyuncs.com/img/image-20240914152349051.png)



### K3引脚列表

![image-20250312141333883](http://tanzhtanzh.oss-cn-shenzhen.aliyuncs.com/img/image-20250312141333883.png)

K8引脚列表



## GPIO

开发板的扩展引脚中默认配置多路可控GPIO。

首先，通过[扩展引脚](#ExpansionPin)章节，确认GPIO引脚位置、编号，参考以下步骤可对指定GPIO进行状态控制。

### 用户层控制GPIO电平

> 默认软件拓展引脚中配置为GPIO一般都注册为此方式控制
>
> 此方式可控制引脚输出高电平或低电平

**查看GPIO注册列表**

```
$ ls /sys/class/leds/

gpio1b0/ gpio1b2/ gpio1d4/ gpio3b6/ 
gpio1a4/ gpio1b1/ gpio1d0/ gpio3b5/ gpio4c4/
```

**命令行控制GPIO**

```
$ echo 1 > /sys/class/leds/gpio3b6/brightness
$ echo 0 > /sys/class/leds/gpio3b6/brightness
```



## UART<a id='UART'> </a>

各系列板卡扩展脚一般都有默认配置一路或多路UART，连接好对应要使用的UART，可以按下面的方法进行测试



* 确认使用的串口号

查看对应的节点是否存在

```shell
$ ls /dev/ttyS*
```

> 例如 uart4 对应 /dev/ttyS4

使用 microcom 进行通信测试

> Android默认安装有microcom 

```shell
$ microcom -s 115200 /dev/ttyS4
```

>如串口4查找到的节点为 /dev/ttyS4
>
>-s 设置波特率为 115200

使用minicom验证：

> Linux建议使用minicom 

**第一次安装需要配置一下：** 

* minicom -s 将 Serial port setup>> F   Hardware Flow Control 关掉  

* Esc按键或回车返回上一层选择Save setup as dfl保存
* Exit from Minicom 退出

使用命令：

```shell
$ minicom -b 9600 -D /dev/ttyS3
```

> 默认显示：接收的内容会打印出来，发送的内容无打印
>
> crt+A 进入控制 B-Z命令  Z为help

> | Ctrl+A X | 退出程序                        |
> | -------- | ------------------------------- |
> | Ctrl+A W | 启用/禁用自动换行，默认禁用     |
> | Ctrl+A E | **启用/禁用输入显示**，默认禁用 |
> | Ctrl+A C | 清屏                            |

或者使用echo直接发送

```shell
$ stty -F /dev/ttyAS3 -a 	//可以看默认波特率
$ stty -F /dev/ttyAS3 115200 	//可以设置
$ echo "123" > /dev/ttyAS3
```




## PWM <a id="PWM"> </a>

RK3568 有4个PWM模块，每个PWM模块有4路PWM，一共有16路PWM

### 用户层配置PWM输出

Extend 40Pin接口 包含多路PWM，以PWM3通道为例，按照以下命令进入PWM配置

按照示例配置参数设置成功后，可用万用表测量PWM3引脚，正确电压应为1.6V左右



示例：设置PWM3通道，周期10000ns，占空比5000ns，极性为normal

PWM路径为/sys/class/pwm，pwmchip* 则按你使能顺序从0开始排序  设置pwmchip0如下：

```
$ echo 0 > /sys/class/pwm/pwmchip0/export
$ echo 10000 > /sys/class/pwm/pwmchip0/pwm0/period
$ echo 5000 > /sys/class/pwm/pwmchip0/pwm0/duty_cycle
$ echo normal > /sys/class/pwm/pwmchip0/pwm0/polarity
$ echo 1 > /sys/class/pwm/pwmchip0/pwm0/enable
```



* 如何确认 pwmchip 对应的 pwm

```
$ find /sys/devices/ | grep pwmchip | grep uevent
/sys/devices/platform/fd8b0020.pwm/pwm/pwmchip1/uevent
/sys/devices/platform/fd8b0010.pwm/pwm/pwmchip0/uevent
/sys/devices/platform/fd8b0030.pwm/pwm/pwmchip2/uevent
```

>fd8b0010.pwm 为 dts 对应的节点 



## ADC

主板扩展引脚配备DC，通过[扩展引脚章节](#ExpansionPin-K7)查看对应的 ADC 位置及通道号。

下面以 SARADC_VIN3 进行示例说明。

**读取ADC值**

```
$ cat /sys/bus/iio/devices/iio\:device0/in_voltage*_raw
```

示例：

读取通道3的电压值 

```
#  cat /sys/bus/iio/devices/iio\:device0/in_voltage3_raw
3528
```

