# 03-功能测试



## LED

开发板配备两个LED灯，默认状态下，绿色LED为电源指示灯，蓝色LED为心跳指示灯

电源指示灯上电即长亮，心跳灯内核启动后持续闪烁。另外，可参考以下方面控制LED作为其他功能。


### 用户层控制LED状态

默认LED触发方式为heartbeat，此方式下LED状态不可人为控制。

若想要实现命令控制LED状态的话，可通过以下命令设置为none，然后再设置LED的brightness

```shell
$ echo none > /sys/class/leds/sysled/trigger
$ echo 1 > /sys/class/leds/sysled/brightness
$ echo 0 > /sys/class/leds/sysled/brightness
```





## 普通串口

**注册结点后**

```
$ ls dev/ttyS*
```

ttyS0<-> DEBUG_UART0

ttyS2<->UART2

ttyS7<->UART7

设置波特率

``` 
stty -F /dev/ttyS1 ispeed 115200 ospeed 115200 cs8
```



可以使用 进行测试拓展 UART2







## WIFI / BlueTooth

K5 开发板 配备 AW859A高性能WIFI模块

支持2.4G/5G双频段，WIFI5，1T1R，BT5.0




## KEY

K5 配备3个按键，分别是FEL KEY、RST KEY、PER KEY

FEL KEY：按键在UBOOT阶段可用于进入烧录模式

RESET KEY : 系统复位键

POWER KEY : 电源键



## RTC

主板上丝印为 RTC，测试 RTC 功能必须外接纽扣电池，并且确认电池电量充足

**掉电保存时间测试**

测试步骤：

1 开发板连接网络，自动同步正确网络时间

2 断开网络连接，并且断开开发板供电电源

3 等待若干时间后，重新接上开发板电源

4 若系统时间与当前时间一致，则RTC功能正常



## LCD

K5开发板支持 Single LVDS 、DUAL LVDS

背光修改

``` shell
echo lcd0 > /sys/kernel/debug/dispdbg/name
echo setbl > /sys/kernel/debug/dispdbg/command
echo 128 > /sys/kernel/debug/dispdbg/param
echo 1 > /sys/kernel/debug/dispdbg/start
echo setbl > /sys/kernel/debug/dispdbg/command
echo 255 > /sys/kernel/debug/dispdbg/param
echo 1 > /sys/kernel/debug/dispdbg/start	
```









## FAN

主板上丝印为 FAN

丝印上的FAN 通过GPIO控制风扇，软件默认为打开

控制方式如下

```shell
// 查看风扇状态
console:/ # cat /sys/class/leds/fan_en/brightness
255
// 打开
console:/ # echo 255 > /sys/class/leds/fan_en/brightness
// 关闭
console:/ # echo 0 > /sys/class/leds/fan_en/brightness
```




## 喇叭

主板上丝印有P和N标识，有两个座子，靠近风扇一侧的喇叭座子为左音道，另一个为右音道



## 耳机

主板上丝印为 HEADPHONE

3.5 mm 耳机接口，仅支持音频输出功能



## ETH

支持千兆网

```
测试速率:
上行速率 783 Mbits/sec 
下行速率 898 Mbits/sec 
```



## tinycap录音

```
console:/ # tinycap
Usage: tinycap file.wav [-D card] [-d device] [-c channels] [-r rate] [-b bits] [-p period_size] [-n n_periods] [-T capture time]
```

```
tinycap file.wav -D 0 -d 0  -c 2 -r 48000 -b 16 -T 10
```





## Linux 功能测试

### alsa工具环境

```
sudo apt install alsa-utils
```

```
sudo apt-get install sox libsox-fmt-all
```

列出控制列表

```
root@kickpi:~# amixer controls
numid=14,iface=MIXER,name='Headphone Switch'
numid=2,iface=MIXER,name='ADC Swap'
numid=8,iface=MIXER,name='ADC volume'
numid=12,iface=MIXER,name='ADCL Input MIC1 Boost Switch'
numid=13,iface=MIXER,name='ADCR Input MIC2 Boost Switch'
numid=7,iface=MIXER,name='DAC volume'
numid=15,iface=MIXER,name='HpSpeaker Switch'
numid=11,iface=MIXER,name='LINEOUT Output Select'
numid=16,iface=MIXER,name='LINEOUT Switch'
numid=6,iface=MIXER,name='LINEOUT volume'
numid=4,iface=MIXER,name='MIC1 gain volume'
numid=5,iface=MIXER,name='MIC2 gain volume'
numid=10,iface=MIXER,name='audiocodec rx_sync switch'
numid=1,iface=MIXER,name='codec hub mode'
numid=3,iface=MIXER,name='digital volume'
numid=9,iface=MIXER,name='headphone gain'
```

使用

```
amixer cget + [controls内容]
```



### 开启耳机开关

查看耳机开关状态

```
# amixer cget numid=14,iface=MIXER,name='Headphone Switch'
numid=14,iface=MIXER,name='Headphone Switch'
  ; type=BOOLEAN,access=rw------,values=1
  : values=off
```

打开耳机

```
# amixer cset numid=14,iface=MIXER,name='Headphone Switch' 1
numid=14,iface=MIXER,name='Headphone Switch'
  ; type=BOOLEAN,access=rw------,values=1
  : values=on
```



### 麦克风开关

```
numid=12,iface=MIXER,name='ADCL Input MIC1 Boost Switch'
打开
amixer cset numid=12,iface=MIXER,name='ADCL Input MIC1 Boost Switch' 1
amixer cset numid=13,iface=MIXER,name='ADCR Input MIC2 Boost Switch' 1
关闭
amixer cset numid=12,iface=MIXER,name='ADCL Input MIC1 Boost Switch' 0
amixer cset numid=13,iface=MIXER,name='ADCR Input MIC2 Boost Switch' 0
查看
amixer cget numid=12,iface=MIXER,name='ADCL Input MIC1 Boost Switch'
amixer cget numid=13,iface=MIXER,name='ADCR Input MIC2 Boost Switch'
```



### 录音测试

```
arecord test.wav
arecord -r 16000 -f S16_LE -d 5 test.wav
arecord -r 48000 -f S16_LE -d 5 test.wav -c 2
```

```
-r 代表 rate
目前测试支持
	8000
	16000
	24000
	32000
	48000
-c 
	1: Mono
	2: Stereo
-d 
	S16_LE
	S24_LE
```



### 播放测试

```
aplay test.wav
play test/Music/1.mp3
```



### 喇叭控制

 (音频流与耳机同一流输出，所以必须同时打开耳机开关)

```
打开
echo 255 > /sys/class/leds/spk_en/brightness

关闭
echo 0 > /sys/class/leds/spk_en/brightness
```



### 风扇开关

软件默认为开

```
打开
echo 255 > /sys/class/leds/fan_en/brightness
关闭
echo 0 > /sys/class/leds/fan_en/brightness
```



### wifi 测试


查看网络设备列表

```
sudo nmcli dev
```

开启wifi

```
sudo nmcli r wifi on
```

关闭wifi

```
sudo nmcli r wifi off
```

扫描附件热点

```
sudo nmcli dev wifi
```

连接 用户 SSID 密码的 PASSWORD 的热点 (其他热点修改对应用户及密码)

```
sudo nmcli dev wifi connect "SSID" password "PASSWORD" ifname wlan0
```



### 蓝牙测试

```
sudo apt-get install bluez
hciconfig -a
hcitool scan
```



### 4G 模块测试

注意事项

```
确认usb模块是否加载
lsusb

确认串口结点是否生成
ls /dev/ttyUSB*

插入电话卡，建议重启
注意EC20模块天线，以及测试的环境
```

拨号测试

```
pppd call quectel-ppp &

ping www.baidu.com 测试

可能会出现没播通情况

通过切换后台程序杀掉
jobs   // 查看后台
fg %1 
ctrl + c 
重新拨号 pppd call quectel-ppp &

或者通过ps -ef | grep pppd 查看进程号
kill -9 (进程号)
重新拨号 pppd call quectel-ppp &
```



### sd卡 测试

```
$ fdisk -l
Device         Boot Start       End   Sectors  Size Id Type
/dev/mmcblk1p1      32768 124735487 124702720 59.5G  7 HPFS/NTFS/exFAT

$ mount /dev/mmcblk1p1 /mnt/
```



### 触摸测试

```
cat /proc/bus/input/devices
apt install evtest
evtest
```



### u盘 、sd卡

```
fdisk -l
```



## USB摄像头

> 测试平台Android

直接接上USB摄像头就可以使用，但是目前测试存在兼容性问题

测试中1080P测试正常、720P存在预览变形、无法录像问题。



