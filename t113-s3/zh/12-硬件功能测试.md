# 12-硬件功能测试





## 扩展引脚

![image-20240713100507130](http://tanzhtanzh.oss-cn-shenzhen.aliyuncs.com/img/K4B详情页_08.jpg)

## LVDS

### 显示
```
echo 8 > /sys/devices/virtual/disp/disp/attr/colorbar
```
### 触控




### 背光

```
/usr/bin/lcd_bright_test 2 255
/usr/bin/lcd_bright_test 2 0
```



## Buildroot测试脚本

```
buildroot/package/auto/sdk_demo/

alpha_test/         bin/                dvr_test/           gif2rgb_test/       mem_test/           tpadc_test/         
audioenc_test/      csi_test/           encoder_test/       gpio_test/          multiscreen_test/   tvd_test/           
autplayer_test/     decoder_test/       fbinit_test/        lcd_bright_test/    record_test/        usbcam_test/        
awrpaf_test/        dsp_debug_test/     g2d_test/           Makefile            stream_player_test/ yuv_test/  
```





## DUAL LVDS





## 耳机

``` 
tinymix set "Headphone Switch" 1
aplay -Dhw:audiocodec  -vv sample-15s.wav
```





## 喇叭

![1730786055916](http://tanzhtanzh.oss-cn-shenzhen.aliyuncs.com/img/1730786055916.png)

播放音频

```
aplay -Dhw:audiocodec -vv sample-15s.wav
```



## 麦克风

``` 
arecord -Dhw:audiocodec -f S24_LE -r  16000  -vvv  test.wav
aplay -Dhw:audiocodec  -vv test.wav
```



## WIFI







## 蓝牙







## RTC

主板上丝印为 RTC，测试 RTC 功能必须外接纽扣电池，并且确认电池电量充足

**掉电保存时间测试**

测试步骤：

设置系统时间并同步到外部RTC时钟

``` 
date -s "2024-11-06 10:30:00" && hwclock -w -f /dev/rtc1
```

断电，等待若干时间后，重新接上开发板电源

``` 
hwclock -f /dev/rtc1 
```

若系统时间与当前时间一致，则RTC功能正常





## 4G Mobile



## SD

将格式化后的SD卡插入SD卡槽，系统自动挂载

``` 
time dd if=/dev/zero of=/mnt/sdcard/mmcblk1p1/test bs=1M count=300 oflag=direct
```

## USB

将格式化后的U盘USB接口，系统自动挂载
``` 
time dd if=/dev/zero of=/mnt/usb/sda1/test bs=1M count=300 oflag=direct
```


## CAN

### CAN收发测试

K4B支持两路CAN接口，可将两路CAN连接后做收发测试

**硬件连接**

CANL <---> CANL

CANH <---> CANH

![image-20240930140153264](http://tanzhtanzh.oss-cn-shenzhen.aliyuncs.com/img/image-20240930140153264.png)



**测试命令**

```
# 初始化CAN0
$ ip link set can0 down
$ ip link set can0 type can bitrate 500000
$ ip link set can0 up

# 初始化CAN1
$ ip link set can1 down
$ ip link set can1 type can bitrate 500000
$ ip link set can1 up

# 开始收发测试(CAN0接受、CAN1发送)
$ candump can0
$ cansend can1 123#DEADBEEF
```





## 串口

K4B 配备4路串口

**查看串口设备节点**

```
$ ls /dev/ttyS*
ttyS1  ttyS3  ttyS4  ttyS5
```

> 串口设备节点说明：
>
> ​	ttyS1 作为 RS485串口
>
> ​	ttyS3 作为 调试串口
>
> ​	ttyS4 作为 TTL串口
>
> ​	ttyS5 作为 RS232串口



### 调试串口测试

![{50132506-DFF8-4D5F-B81D-B7BF351E7D1F}](http://tanzhtanzh.oss-cn-shenzhen.aliyuncs.com/img/{50132506-DFF8-4D5F-B81D-B7BF351E7D1F}.png)

**下载串口助手软件**

串口助手软件 可自行下载，下面以Mobaxterm为例

Mobaxterm软件地址下载：https://mobaxterm.mobatek.net/

**Mobaxterm操作步骤**

1. 新建会话窗口
2. 选择会话窗口类型为serial
3. 选择串口COM编号（打开Windows系统 设备管理器 -> 端口界面可查看COM编号）
4. 选择串口波特率115200
5. 启动会话窗口


### TTL串口测试

**硬件连接**

![image-20241105101842412](http://tanzhtanzh.oss-cn-shenzhen.aliyuncs.com/img/image-20241105101842412.png)
**测试命令**

``` 
minicom -D /dev/ttyS4 -b 115200
```


### RS232串口测试

**硬件连接**





**测试命令**

stty -F /dev/ttyS5 speed 115200 cs8



### RS485串口测试

**硬件连接**





**测试命令**



